<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- Full-screen overlay for download -->
    <div id="overlay">
        <img src="loading-image.png" alt="Downloading..." id="overlay-img">
    </div>

    <h1>YouTube Proxy</h1>
    <div class="container">
        <input type="text" id="url" placeholder="Enter YouTube URL" class="url-input">
        <div class="buttons">
            <button id="downloadShorts" class="download-btn shorts-btn">Download Shorts</button>
            <button id="downloadVideo" class="download-btn video-btn">Download Video</button>
        </div>
        <input type="text" id="url1" placeholder=" Extract Audio" class="url1-input">
        <div class = "buttons">
            <button id = "downloadAudio" class="download-btn audio-btn">Download Audio</button>
        </div>
    </div>

    <style>
    #overlay {
        position: fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background: rgba(0,0,0,0.9);
        display:none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    #overlay img {
        max-width: 80%;
        max-height: 80%;
    }
    </style>

    <script>
      // Buttons
      document.getElementById('downloadShorts').addEventListener('click', () => openDownloadModal('shorts'));
      document.getElementById('downloadVideo').addEventListener('click', () => openDownloadModal('video'));
      document.getElementById('downloadAudio').addEventListener('click', () => openDownloadModal('audio'));

      function openDownloadModal(type) {
        const videoUrl = document.getElementById('url').value.trim();
        const audioUrl = document.getElementById('url1').value.trim();
        const finalUrl = type === 'audio' ? audioUrl : videoUrl;

        if (!finalUrl) {
          alert('Please enter a YouTube URL');
          return;
        }

        // Build endpoint
        let endpoint = '';
        if(type === 'audio'){
            endpoint = `/audio-download?audioURL=${encodeURIComponent(finalUrl)}`;
        } else {
            endpoint = `/download?videoURL=${encodeURIComponent(finalUrl)}&type=${type}`;
        }

        // Show overlay
        document.getElementById('overlay').style.display = 'flex';

        // Trigger download using invisible link
        const a = document.createElement('a');
        a.href = endpoint;
        a.download = '';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        // Hide overlay after estimated download time (adjust if needed)
        setTimeout(() => {
            document.getElementById('overlay').style.display = 'none';
        }, 240000); // 5 seconds for demo, increase for larger files
      }
    </script>
</body>
</html>